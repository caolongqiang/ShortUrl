# ShortUrl

##概述

短链接算法，要求链接够短，而且要唯一，比如“a7yu8P”，6位，还有就是用户输入的同一个url，应该返回唯一的短链接。用户在请求长url之后，先看有没有生成过，如果生成过，则直接取出对应的短代码，如果不存在，则生成短代码，保存起来。用户请求短链接时，根据key-value对，做301转发。

## 实现步骤

1、定义算法，将长链接映射成短字符串。

2、存储短字符串和长链接的key-value对。

3、应用转发。

h2. url映射算法

#### 普通实现

A-Za-z0-9一共62个字符表示62进制。


将长链接存入数据库，对返回的id进行62进制转码。

优点：简单方便，基本不会重复。

缺点：需要数据库支持，没办法保证所有链接都是固定的位数的长度（可以让id从100000000开始，就是6位字符了）。


####. 文艺实现

算法描述：使用6个字符来表示短链接，我们使用ASCII字符中的'a'-'z','0'-'5'，共计32个字符做为集合。每个字符有32种状态，六个字符就可以表示32^6（1073741824），那么如何得到这六个字符，描述如下：

对传入的长URL进行Md5，得到一个32位的字符串，这个字符串变化很多，是16的32次方，基本上可以保证唯一性。将这32位分成四份，每一份8个字符，这时机率变成了16的8次方，是4294967296，这个数字碰撞的机率也比较小啦，关键是后面的一次处理。我们将这个8位的字符认为是16进制整数，然后取0-30位，每5个一组，算出他的整数值，然后映射到我们准备的32个字符中，最后就能够得到一个6位的短链接地址。

#### 二逼实现

纯随机的方式来生成一个短链接，看数据库有没有，如果有，重新生成，如果没有，则应用。

## K-V存储方案

#### 数据库存储

简单方便，容易管理

#### redis存储

缓存配置，访问解析速度快

## 前端转发方案

####  nginx lua

## nginx接口


#### 给de调用的生成短链接的接口

输入：原始链接

输出：生成的短链接，json格式，如果出错，返回出错信息

逻辑：根据生成算法生成端链接，以短链接为key，原始网址为value存储在redis中，并返回给DE。


#### 前端应用转发的接口

输入：shorl-url.com/su/9b7yop

逻辑：以9b7yop为key进行redis查询，正常则redirect到对应value，同时，记录访问次数。

如果找不到，则redirect到网站首页。

如果连不上redis，则报警，同时redirect到网站首页。




#### 根据key进行查询的接口

输入：key

输出：redis中存储的hash信息。
